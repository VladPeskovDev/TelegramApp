const TelegramBot = require('node-telegram-bot-api');
const { User } = require('../db/models');
require('dotenv').config();

// eslint-disable-next-line no-undef
const bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN, { polling: true });

bot.setMyCommands([
  { command: '/start', description: 'üöÄ –ù–∞—á–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–æ—Ç–æ–º' },
  { command: '/info', description: '‚ÑπÔ∏è –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ' },
  { command: '/help', description: '‚ùì –ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞' },
  { command: '/feedback', description: '‚úâÔ∏è –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏' },
]);


bot.onText(/\/start/, async (msg) => {
  const chatId = String(msg.chat.id);  

  try {
    const [user, created] = await User.findOrCreate({
      where: { telegram_id: chatId },
      defaults: { telegram_id: chatId },
    });

    
    const url = `https://tgqueue.ru?telegram_id=${chatId}`;
    //const url = `https://ac49-5-228-82-124.ngrok-free.app?telegram_id=${chatId}`;

    if (created) {
      bot.sendMessage(chatId, '–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ —Å–∏–∑–æ', {
        reply_markup: {
          inline_keyboard: [
            [{ text: '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ —Å–∏–∑–æ', web_app: { url } }]
          ],
        },
      });
    } else {
      bot.sendMessage(chatId, '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ —Å–∏–∑–æ', {
        reply_markup: {
          inline_keyboard: [
            [{ text: '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ —Å–∏–∑–æ', web_app: { url } }]
          ],
        },
      });
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    bot.sendMessage(chatId, '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
  }
});

bot.onText(/\/info/, (msg) => {
  const chatId = String(msg.chat.id);

  const infoMessage = `
    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞ –∑–∞–ø–∏—Å–∏ –≤ –°–ò–ó–û!

–≠—Ç–æ—Ç –±–æ—Ç —Å–æ–∑–¥–∞–Ω —ç–Ω—Ç—É–∑–∏–∞—Å—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–º –Ω–∞–¥–æ–µ–ª–æ –µ–∑–¥–∏—Ç—å –≤ –°–ò–ó–û –ø–æ –Ω–æ—á–∞–º –∏–ª–∏ —Ä–∞–Ω–æ —É—Ç—Ä–æ–º, —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º—è—Ç–æ–º –ª–∏—Å—Ç–æ—á–∫–µ.
–ù–∞–º –Ω–∞–¥–æ–µ–ª–æ, —á—Ç–æ —ç—Ç–æ—Ç –º—è—Ç—ã–π –ª–∏—Å—Ç–æ—á–µ–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–≤—É—Ç, –∏ –Ω–∞ —É—Ç—Ä–æ –≤—ã—è—Å–Ω—è–µ—Ç—Å—è, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π –æ—á–µ—Ä–µ–¥–∏.
–ù–∞–º –Ω–∞–¥–æ–µ–ª–æ, —á—Ç–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ –°–ò–ó–û, —ç—Ç–æ—Ç —Å–∞–º—ã–π –ª–∏—Å—Ç–æ—á–µ–∫ –Ω—É–∂–Ω–æ –≤—Å—é –Ω–æ—á—å –æ—Ö—Ä–∞–Ω—è—Ç—å.
–ú—ã —Ä–µ—à–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ä–≤–∞—Ç—å, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –Ω–µ –Ω—É–∂–Ω–æ –µ—Ö–∞—Ç—å, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –∏ –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –Ω—É–∂–Ω–æ –æ—Ö—Ä–∞–Ω—è—Ç—å.
–ü–æ–ª—å–∑—É—è—Å—å —ç—Ç–∏–º –±–æ—Ç–æ–º, –≤—ã –≤—Å–µ–≥–¥–∞ —Å–º–æ–∂–µ—Ç–µ –æ—Ü–µ–Ω–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —É–∂–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–≤—à–µ–π—Å—è –æ—á–µ—Ä–µ–¥–∏ –∏ –∑–¥—Ä–∞–≤–æ –æ—Ü–µ–Ω–∏—Ç—å —Å–≤–æ–∏ —à–∞–Ω—Å—ã –Ω–∞ –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –°–ò–ó–û, –Ω–µ –ø—Ä–∏–µ–∑–∂–∞—è –≤ –ø–æ–∏—Å–∫–∞—Ö —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ –ª–∏—Å—Ç–æ—á–∫–∞. –ê —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ —ç—Ç–æ –≤—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ!
  `;

  bot.sendMessage(chatId, infoMessage);
});

bot.onText(/\/help/, (msg) => {
  const chatId = String(msg.chat.id);

  const infoMessage = `
   –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞ –∑–∞–ø–∏—Å–∏ –≤ –∂–∏–≤—É—é –æ—á–µ—Ä–µ–¥—å –°–ò–ó–û –≥–æ—Ä–æ–¥–∞ –ú–æ—Å–∫–≤—ã!

–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º:

1) –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ—Å–µ—â–µ–Ω–∏–µ –°–ò–ó–û.
2) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞—à—É –∑–∞–ø–∏—Å—å –≤ –°–ò–ó–û.
3) –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –°–ò–ó–û, –µ—Å–ª–∏ –≤–∞—à–∏ –ø–ª–∞–Ω—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å.
4) –£–∑–Ω–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –ª–∏—Ü –∏ –æ—Ü–µ–Ω–∏—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–∏–∑–∏—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –¥–µ–Ω—å.

–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –°–ò–ó–û" -> –ó–∞—Ç–µ–º –≤ –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –í–∞–º –°–ò–ó–û -> –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∑–∞–ø–∏—Å–∏ (–Ω–∞–¥ –¥–∞—Ç–æ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–û—á–µ—Ä–µ–¥—å –æ—Ç–∫—Ä—ã—Ç–∞¬ª) -> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è", —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å. 

–í —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å. (–ü–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã –∑–∞–ø–∏—Å–∏ –≤—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –º–µ—Å—Ç–æ –≤ –æ—á–µ—Ä–µ–¥–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.) 

–° –æ–¥–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –æ–¥–Ω—É –æ—á–µ—Ä–µ–¥—å –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑. –û—á–µ—Ä–µ–¥—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞ –¥–µ–Ω—å –¥–æ –¥–∞—Ç—ã –ø–æ—Å–µ—â–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è —Å 18:00 –¥–æ 23:59.

–°–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å—Å—è –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞, –∏ –æ–Ω–æ –Ω–∏–∫–æ–º—É –Ω–µ –∏–∑–≤–µ—Å—Ç–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ, –≤ —Ü–µ–ª—è—Ö –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è  –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏.
  `;

  bot.sendMessage(chatId, infoMessage);
});

bot.onText(/\/feedback/, (msg) => {
  const chatId = String(msg.chat.id);

  const infoMessage = `
   –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –∫–∞–∫–∏–µ-–ª–∏–±–æ –ø—Ä–æ–±–ª–µ–º—ã, –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞—à–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –ø–æ –∞–¥—Ä–µ—Å—É: feedbackbot24@yahoo.com –ú—ã –≤—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –≤–∞—à–∏–º –æ—Ç–∑—ã–≤–∞–º –∏ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å!
  `;

  bot.sendMessage(chatId, infoMessage);
});



module.exports = bot; 

//ngrok http 5173



